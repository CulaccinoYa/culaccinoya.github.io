<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
		<title>操行分查询</title>
		<link rel="stylesheet" type="text/css" href="./css/preload.css">
		<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.2/css/bootstrap.min.css"/>
		<link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.4/font/bootstrap-icons.min.css" rel="stylesheet">
		<link href="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css" rel="stylesheet">
		<style>*{--bs-danger-rgb:255, 71, 87;--bs-success-rgb:46, 213, 115}</style>
	</head>
	<body class="bg-light">
		<!-- 预加载 -->
		<div id="preloader" class="preloader">
			<div class="spinner-border" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>
		<div class="container pt-2">
			<div class="row">
				<div class="col-6 col-xl-3 my-2">
					<div class="card bg-primary text-white border-0 shadow">
						<div class="card-body">
						    <div class="d-flex justify-content-between">
								<span class="rounded-circle bg-white bg-opacity-25 fs-2 px-2">
						            <i class="bi bi-person-fill"></i>
						        </span>
						        <span class="fs-6">学生姓名</span>
						    </div>
						    <div class="text-end fs-4" id="name"></div>
						</div>
					</div>
				</div>
			    <div class="col-6 col-xl-3 my-2">
					<div class="card bg-primary text-white border-0 shadow">
						<div class="card-body">
						    <div class="d-flex justify-content-between">
								<span class="rounded-circle bg-white bg-opacity-25 fs-2 px-2">
						            <i class="bi bi-piggy-bank-fill"></i>
						        </span>
						        <span class="fs-6">当前分数</span>
						    </div>
						    <div class="text-end fs-4" id="score"></div>
						</div>
					</div>
			    </div>
				<div class="col-xl-6 my-2">
					<div class="card border border-0 border-top border-5 border-primary shadow">
						<div class="card-body">
							<div class="card-title"><b>计分说明</b></div>
						    <span>当前分数计算公式如下：</span><br>
							<span><b>基础分60 + 加分项 - 扣分项 = 当前分数</b></span><br><br>
							<span class="form-text">* 当前分数为目前系统计算的大致分数，实际分数可能会因为基础分变动或其他情况发生变化，请以最终实际分数为准</span>
							<button class="mt-2 btn btn-danger col-12 btn-sm">退出登录</button>
						</div>
					</div>
				</div>
			</div>
			<div class="row mt-4" id="list">
			</div>
		</div>
	</body>

	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
	<script src="./js/default.js"></script>
	<script>
		// 原生js操作预加载
		document.onreadystatechange = function(){
			if(document.readyState == 'complete'){
				document.getElementById("preloader").style.display="none";
			}
		}
		$(function(){
			let user=$.cookie('student_id')
			let loading=$.alert({content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>操作正在处理</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
			$.ajax({
				type:"GET",
				url:Host+"GetUserDetail",
				data:{"user":user},
				contentType:"application/json;charset=UTF-8",
				success:function (data) {
				    loading.close();
					if(data.code==200){
						$("#name").text(data.data.name)
						$("#score").text(data.data.score)
						if(!data.data.data.length){
							$('#list').append('<div class="col-xl-3 col-md-6 my-2"><div class="card border border-0 border-top border-5 border-primary shadow"><div class="card-body">没有加减分记录</div></div></div>')
						}else{
							for(var n=0;n<data.data.data.length;n++){
								let score_class="success"
								let score_text="加"
								if(data.data.data[n].score<0){
									score_class="danger"
									score_text="扣"
								}
								let score=Math.abs(data.data.data[n].score)
								let title=data.data.data[n].title
								$('#list').append('<div class="col-xl-3 col-md-6 my-2"><div class="card border border-0 border-top border-5 border-'+score_class+' shadow"><div class="card-body"><h6><b>'+timetostring(data.data.data[n].time)+'</b></h6><div class="d-flex justify-content-between"><span>'+title+'</span><span class="text-'+score_class+'">'+score_text+score+'分</span></div></div></div></div>')
							}
						}
					}else{
						$.alert({type:'red',icon:"bi bi-x-circle-fill",title:'查询失败',content:data.msg,buttons:[],closeIcon:false});
					}
				},
				error:function (msg) {
				    loading.close();
					$.alert({type:'red',icon:"bi bi-x-circle-fill",title:'查询失败',content:'无法连接到查询服务器，可能是<br><br>1.查询人数过多<br>2.查询系统已关闭<br>3.网络信号较差<br><br>建议你等待5-10秒后再次查询，操作速度过快可能会被视为机器人而封禁',buttons:[],closeIcon:false});
				}
			});
		})
		$('button').click(function(){
			$.cookie('student_id',null)
			window.location.href="./index.html"
		})
	</script>
</html>
