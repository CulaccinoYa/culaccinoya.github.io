
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.2/css/bootstrap.min.css"/>
		<link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.2/font/bootstrap-icons.css" rel="stylesheet">
		<link href="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css" rel="stylesheet">
		<title>实名认证</title>
		<style>input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none}*:focus{outline: 0;}</style>
	</head>
	<body>
		<div id="preloader" style="position:fixed;width:100%;height:100vh;background-color:#fbfbfb;z-index:99999;">
			<div style="display:block;text-align:center;margin-top:40vh;">
				<div class="spinner-border ml-auto" aria-hidden="true"></div>
			</div>
			<div style="font-size:.8rem;margin-top:40vh;text-align:center">
				<p class="text-secondary">&copy;Copyright SF工具箱 All.right.<br>长时间无反应?返回后再试试</p>
			</div>
		</div>

		<div class="p-4" id="home2" style="display: none;">
		    <h3 class="mt-4"><b>实名认证</b></h3>
			<p style="font-size: .8rem;">您已完成实名认证，下面是您的认证信息</p>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>姓名<br></span>
				<span id="name"></span>
			</div>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>证件类型<br></span>
				<span id="type"></span>
			</div>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>实名状态<br></span>
				<span id="status"></span>
			</div>
			<div class="text-center mt-4">
				<span>如需修改实名信息，请联系人工客服</span>
			</div>
		</div>

		<div class="p-4" id="home" style="display: none;">
		    <h3 class="mt-4"><b>实名认证</b></h3>
			<p style="font-size: .8rem;">请选择您的验证方式</p>
			<div class="mt-4 card border border-0 border-top border-5 border-primary shadow rounded" id="face">
			    <div class="card-body d-flex align-items-center">
					<svg width="2.4rem" height="2.4rem" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 34V44H14" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M34 44H44V34" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M34 4H44V14" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 4H4V14" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 34C16 34 19 37 24 37C29 37 32 34 32 34" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 14V23C24 25 22 27 20 27H19" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M34 14V16" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 14V16" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>
					<div class="ms-2"><p class="m-0">面部信息验证</p><span class="text-secondary" style="font-size: .8rem;">通过刷脸与公安系统进行对比验证</span></div>
			    </div>
			</div>
			<div class="mt-4 card border border-0 border-top border-5 border-primary shadow rounded" id="photo">
			    <div class="card-body d-flex align-items-center">
					<svg width="2.4rem" height="2.4rem" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M42 8H6C4.89543 8 4 8.89543 4 10V38C4 39.1046 4.89543 40 6 40H42C43.1046 40 44 39.1046 44 38V10C44 8.89543 43.1046 8 42 8Z" fill="none" stroke="#000" stroke-width="4" stroke-linejoin="round"/><path d="M36 16H28V24H36V16Z" fill="none" stroke="#000" stroke-width="4" stroke-linejoin="round"/><path d="M12 32H36" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 16H18" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 24H18" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>
					<div class="ms-2"><p class="m-0">身份证照片验证</p><span class="text-secondary" style="font-size: .8rem;">通过上传本人的身份证照片进行验证</span></div>
			    </div>
			</div>
			<div class="text-center mt-4">
				<span>实名认证仅支持中国大陆居民<br>港澳台及其他地区，或使用其他证件实名的，请联系人工客服</span>
			</div>
		</div>

		<div class="p-4" id="step1-1" style="display: none;">
			<h3 class="mt-4"><b>面部信息验证</b></h3>
			<p style="font-size: .8rem;">请输入您的居民身份证信息</p>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>姓名</span>
				<input class="border-0 col-12" type="text" id="name" placeholder="证件上的姓名" />
			</div>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>身份证号码</span>
				<input class="border-0 col-12" type="text" id="idno" placeholder="请输入合法有效的身份证号码" />
			</div>
			<button class="col-12 mt-4 btn btn-primary rounded-pill">下一步</button>
			<button class="col-12 mt-2 btn btn-outline-primary rounded-pill">返回</button>
		</div>

		<div class="p-4" id="step2-1" style="display: none;">
		    <h3 class="mt-4"><b>上传证件照片验证</b></h3>
			<p style="font-size: .8rem;">请上传您的居民身份证正反面照片</p>
			<div class="card border border-0 border-top border-5 border-primary shadow rounded">
			    <div class="card-body">
					<div class="d-flex justify-content-between align-items-center">
						<img id="frontimg" class="col-5" src="https://faceid-h5-1254418846.file.myqcloud.com/images/ocr-update/cardBack/ocr-idcardBack-default2.png"/>
						<button id="frontbtn" class="btn btn-primary rounded-pill">上传国徽面</button>
					</div>
					<div class="mt-4 d-flex justify-content-between align-items-center">
						<img id="backimg" class="col-5" src="https://faceid-h5-1254418846.file.myqcloud.com/images/ocr-update/ocr-idcardPhoto-default.png"/>
						<button id="backbtn" class="btn btn-primary rounded-pill">上传人像面</button>
					</div>
				</div>
			</div>
		    <button id="next" class="col-12 btn-primary mt-4 btn rounded-pill">下一步</button>
			<button class="col-12 mt-2 btn btn-outline-primary rounded-pill">返回</button>
		</div>

		<div class="p-4" id="finish" style="display: none;">
		    <div class="text-center" style="margin-top:20vh">
		        <h2 id="title"><b>实名成功</b></h2>
		        <p id="subtitle" class="text-secondary">您的实名信息已登记完成</p>
		    </div>
		</div>

		<script type="text/javascript" src="https://sftools.link/uni.webview.js"></script>
	    <script type="text/javascript" src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script>
	    <script src="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
	    <script>
		document.onreadystatechange = function(){
			if(document.readyState == 'complete'){
				document.getElementById("preloader").style.display="none";
			}
		}
	    let user;
		let token;
		let front;
		let back;
		window.sftools.init(()=>{
		    window.sftools.run({type:'getUserToken'},e=>{user=e.user;token=e.token;first()},e=>{plus.nativeUI.alert("获取账户信息失败，"+e,_=>{uni.navigateBack()})});
		});
		function first(){
			let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>获取状态中</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
			window.sftools.request({
				url:"Account/GetRealnameStatus",
				success:function(data){
					loading.close();
					if(!data.data.success){
						$('#home').show();
						return;
					}
					$('#home2').show();
					$('#home2 #name').text(data.data.name);
					$('#home2 #type').text(data.data.type);
					$('#home2 #status').text(data.data.status);
				},fail:i=>{
					loading.close();
					$.alert({title:'错误',type:'red',content:i,buttons:[],closeIcon:false}); 
				}
			});
		}
		$('#face').click(_=>{
		    $('#home').hide();
		    $('#step1-1').show();
		});
		$('#photo').click(_=>{
		    $('#home').hide();
		    $('#step2-1').show();
		});
		$('#step1-1 .btn-outline-primary').click(_=>{
		    $('#step1-1').hide();
		    $('#home').show();
		});
		$('#step1-1 .btn-primary').click(_=>{
			let name=$('#step1-1 #name').val()
			let idno=$('#step1-1 #idno').val()
			if(!name){
				$.alert({title:'错误',type:'red',content:'请输入正确的姓名'});
				return;
			}
			if(idno.length!==15&&idno.length!==18){
				$.alert({title:'错误',type:'red',content:'请输入正确的居民身份证'});
				return;
			}
			let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>联网比对中</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
			window.sftools.request({
				url:"Account/RealnameByNumber",
				data:{"type":"reg","name":name,"idno":idno},
				success:function(data){
					loading.close();
					window.sftools.run({type:'face_auth',data:{id:data.data}},e=>{
						let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>联网比对中</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
						window.sftools.request({
							url:"Account/RealnameByNumber",
							data:{"type":"face","name":name,"idno":idno,"faceid":e},
							success:function (data) {
								loading.close();
								if(data.msg=='请求已完成'){
									location.reload();
									return;
								}
								$('#finish #title').text('实名出错');
								$('#finish #subtitle').text(data.msg);
								$('#step1-1').hide();
								$('#finish').show();
							},fail:i=>{
								loading.close();
								$.alert({title:'错误',type:'red',content:i}); 
							}
						});
					},e=>{
						$.alert({title:'错误',type:'red',content:e}); 
					});
				},fail:i=>{
					loading.close();
					$.alert({title:'错误',type:'red',content:i}); 
				}
			});
		})
		$('#frontbtn').click(_=>{
			window.sftools.run({type:'uploadImage',data:{type:0}},e=>{front=e;$('#frontimg').attr('src',e)},e=>{});
		})
		$('#backbtn').click(_=>{
			window.sftools.run({type:'uploadImage',data:{type:0}},e=>{back=e;$('#backimg').attr('src',e)},e=>{});
		})
		$('#step2-1 #next').click(_=>{
			if(!front){
				$.alert({title:'错误',type:'red',content:'请上传证件国徽面'});
				return;
			}
			if(!back){
				$.alert({title:'错误',type:'red',content:'请上传证件人像面'});
				return;
			}
			let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>联网比对中</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
			window.sftools.request({
				url:"Account/RealnameByIdcard",
				data:{"image":{"front":front,"back":back}},
				success:function (data) {
					loading.close();
				    if(data.msg=='请求已完成'){
						location.reload();
					}
					$('#finish #title').text('实名审核中');
					$('#finish #subtitle').text(data.msg);
					$('#step2-2').hide();
					$('#finish').show();
				},fail:i=>{
					loading.close();
					$.alert({title:'错误',type:'red',content:i}); 
				}
			});
		});
		$('#step2-1 .btn-outline-primary').click(_=>{
		    $('#step2-1').hide();
		    $('#home').show();
		});
	    </script>
	</body>
</html>
