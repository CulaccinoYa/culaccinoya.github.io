<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.2/css/bootstrap.min.css"/>
		<link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.2/font/bootstrap-icons.css" rel="stylesheet">
		<link href="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css" rel="stylesheet">
		<title>安全验证</title>
		<style>input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none}*:focus{outline: 0;}</style>
	</head>
	<body>
		<div id="preloader" style="position:fixed;width:100%;height:100vh;background-color:#fbfbfb;z-index:99999;">
			<div style="display:block;text-align:center;margin-top:40vh;">
				<div class="spinner-border ml-auto" aria-hidden="true"></div>
			</div>
			<div style="font-size:.8rem;margin-top:40vh;text-align:center">
				<p class="text-secondary">&copy;Copyright SF工具箱 All.right.<br>长时间无反应?返回后再试试</p>
			</div>
		</div>
		<div class="p-4" id="step1">
		    <h3 class="mt-4"><b>新设备登录验证</b></h3>
			<p style="font-size: .8rem;">您正在一台新设备上登录您的账号，请完成验证</p>
			<div class="card border border-0 border-top border-5 border-primary shadow rounded" id="mobile">
			    <div class="card-body d-flex align-items-center">
					<div><svg width="2.4rem" height="2.4rem" fill="none" viewBox="0 0 48 48"><rect x="11" y="4" width="26" height="40" rx="3" fill="none" stroke="#000" stroke-width="3"/><path d="M22 10L26 10" stroke="#000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 38H28" stroke="#000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
					<div class="ms-2"><p class="m-0">密保手机验证</p><span class="text-secondary" style="font-size: .8rem;">密保手机接收短信或电话验证</span></div>
			    </div>
			</div>
			<div class="mt-4 card border border-0 border-top border-5 border-primary shadow rounded" id="qq">
			    <div class="card-body d-flex align-items-center">
					<div><svg width="2.4rem" height="2.4rem" fill="none" viewBox="0 0 48 48"><path d="M23.7927 44.5178C20.1344 44.5178 16.7762 43.2933 14.6142 41.4646C13.5161 41.7927 12.1115 42.3204 11.2254 42.9751C10.4664 43.535 10.5613 44.1059 10.6979 44.3362C11.298 45.3491 20.9938 44.9831 23.7927 44.6678V44.5178ZM23.7927 44.5178C27.4516 44.5178 30.8095 43.2933 32.9718 41.4646C34.0693 41.7927 35.4742 42.3204 36.3606 42.9751C37.119 43.535 37.0244 44.1059 36.8875 44.3362C36.2874 45.3491 26.5919 44.9831 23.7927 44.6678V44.5178Z" fill="#000"/><path fill-rule="evenodd" clip-rule="evenodd" d="M36.3386 20.9326C34.6979 21.3809 29.856 22.5505 23.8144 22.5914H23.7698C17.5753 22.5491 12.6423 21.3214 11.1274 20.8999C10.816 20.8129 10.6458 20.6334 10.6458 20.6334C10.644 20.5785 10.6207 19.6503 10.6207 19.171C10.6207 11.1055 14.4284 3.00029 23.7922 3C33.1561 3.00029 36.9635 11.1052 36.9635 19.1713C36.9635 19.65 36.9402 20.5785 36.9387 20.6337C36.9387 20.6337 36.7297 20.8255 36.3386 20.9326ZM38.8284 25.3504C39.3462 26.7001 39.8573 28.1055 40.2318 29.3107C42.0176 35.0578 41.4388 37.4364 40.9986 37.4898C40.0532 37.6039 37.3187 33.1634 37.3187 33.1634C37.3187 37.6757 33.2448 44.604 23.916 44.6677H23.6685C14.3394 44.604 10.2655 37.6757 10.2655 33.1634C10.2655 33.1634 7.53131 37.6039 6.58588 37.4895C6.14542 37.4364 5.5666 35.0581 7.35268 29.3107C7.72717 28.1058 8.23827 26.7001 8.75609 25.3504C8.75609 25.3504 9.10519 25.3285 9.28207 25.3795C10.7319 25.798 12.2762 26.1689 13.8447 26.4792C13.5776 28.1343 13.4249 30.1827 13.5692 32.6021C13.9533 39.0363 17.7745 43.081 23.6727 43.1394H23.9121C29.8106 43.081 33.6314 39.0363 34.0161 32.6021C34.1604 30.1823 34.0075 28.1345 33.7402 26.4793C35.3363 26.1633 36.9076 25.7848 38.3798 25.3571C38.5307 25.3136 38.8284 25.3504 38.8284 25.3504ZM33.7402 26.4793C30.3004 27.1601 26.7448 27.5502 23.8144 27.5147H23.7698C20.8396 27.5498 17.2841 27.1598 13.8447 26.4792C13.8586 26.3929 13.8728 26.3076 13.8874 26.2234C17.3136 26.8989 20.8513 27.2853 23.769 27.2503H23.8137L23.814 27.25C26.7323 27.2856 30.2709 26.8989 33.6974 26.2231C33.712 26.3074 33.7262 26.3928 33.7402 26.4793ZM18.0376 11.6868C18.1059 13.5266 19.1912 14.9735 20.4615 14.916C21.7309 14.8594 22.7044 13.3208 22.6349 11.4802C22.566 9.6398 21.4811 8.19348 20.2122 8.2504C18.9419 8.30791 17.9687 9.84646 18.0376 11.6868ZM27.1253 14.916C28.3957 14.9735 29.4809 13.5263 29.5489 11.6868C29.6181 9.84646 28.6449 8.30791 27.3746 8.2504C26.1055 8.19378 25.0208 9.64009 24.9519 11.4805C24.8825 13.3208 25.8556 14.8591 27.1253 14.916ZM23.8148 15.9248C28.0469 15.9248 31.4658 16.7625 31.805 17.5141V17.5144C31.821 17.5477 31.8295 17.5841 31.8298 17.621C31.8294 17.6731 31.8131 17.7238 31.7831 17.7663C31.497 18.1835 27.701 20.2436 23.8148 20.2436H23.7692C19.8827 20.2436 16.0867 18.1829 15.8006 17.7663C15.7708 17.7239 15.7545 17.6734 15.7539 17.6216C15.7542 17.5845 15.7627 17.5479 15.7787 17.5144C16.1182 16.7625 19.5368 15.9248 23.7692 15.9248H23.8148Z" fill="#000"/><path d="M22.0218 11.7142C22.0799 12.441 21.6812 13.0867 21.1327 13.157C20.5831 13.2277 20.0912 12.6958 20.0329 11.969C19.9754 11.2416 20.3735 10.596 20.9211 10.5259C21.4716 10.4547 21.9643 10.9871 22.0218 11.7139V11.7142ZM25.5117 11.9571C25.624 11.7559 26.3885 10.6984 27.9714 11.0834C28.3874 11.1847 28.5797 11.3336 28.6203 11.392C28.6801 11.4784 28.6968 11.6015 28.6358 11.7673C28.5155 12.096 28.2671 12.087 28.1296 12.0227C28.0406 11.9813 26.9381 11.2463 25.9223 12.3429C25.8523 12.418 25.7274 12.4439 25.6091 12.3546C25.4903 12.2647 25.4416 12.0832 25.5117 11.9571Z" fill="#000"/><path d="M15.5039 26.7117V33.0437C15.5039 33.0437 18.4044 33.6286 21.3105 33.2235V27.383C19.4695 27.2788 17.4841 27.0468 15.5039 26.7117Z" fill="#000"/><path d="M36.9385 20.6337C36.9385 20.6337 31.2962 22.4148 23.8142 22.4653H23.7695C16.2998 22.4151 10.6648 20.6395 10.6456 20.6337L8.75586 25.35C13.4824 26.775 19.3401 27.6933 23.7695 27.6399H23.8142C28.2436 27.6933 34.101 26.775 38.8282 25.35L36.9385 20.6337Z" fill="#000"/></svg></div>
					<div class="ms-2"><p class="m-0">社交账号验证</p><span class="text-secondary" style="font-size: .8rem;">社交账号发送指定内容验证</span></div>
			    </div>
			</div>
			<div class="mt-4 card border border-0 border-top border-5 border-primary shadow rounded" id="qrcode">
			    <div class="card-body d-flex align-items-center">
					<div><svg width="2.4rem" height="2.4rem" viewBox="0 0 48 48" fill="none"><path d="M20 6H6V20H20V6Z" fill="none" stroke="#000" stroke-width="3" stroke-linejoin="round"/><path d="M20 28H6V42H20V28Z" fill="none" stroke="#000" stroke-width="3" stroke-linejoin="round"/><path d="M42 6H28V20H42V6Z" fill="none" stroke="#000" stroke-width="3" stroke-linejoin="round"/><path d="M29 28V42" stroke="#000" stroke-width="3" stroke-linecap="round"/><path d="M41 28V42" stroke="#000" stroke-width="3" stroke-linecap="round"/></svg></div>
					<div class="ms-2"><p class="m-0">旧设备扫码验证</p><span class="text-secondary" style="font-size: .8rem;">人脸识别与绑定的身份信息验证</span></div>
			    </div>
			</div>
			<div class="mt-4 text-center">以上方式都无法使用？请联系<a href="//sf.suxber.live/app/system/group.html">人工客服</a></div>
		</div>

		<div class="p-4" id="mobile_page" style="display: none;">
		    <h3 class="mt-4"><b>密保手机验证</b></h3>
			<p style="font-size: .8rem;">请输入该账号的密保手机号</p>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>密保手机号</span>
				<div class="d-flex col-12">
					<input class="border-0 col-8" type="number" id="mobile_input" placeholder="账户绑定的密保手机号"/>
					<a id="getcode">获取验证码</a>
				</div>
			</div>
			<div class="mt-4 border-bottom pb-1 px-2">
				<span>验证码</span>
				<input class="border-0 col-12" type="number" id="code" placeholder="请输入收到的验证码"/>
			</div>
			<button class="col-12 mt-4 btn btn-outline-primary rounded-pill">返回</button>
		    <button class="col-12 mt-2 btn btn-primary rounded-pill">完成</button>
		</div>

		<div class="p-4" id="qq_page"  style="display: none;">
		    <h3 class="mt-4"><b>社交账号验证</b></h3>
			<p style="font-size: .8rem;">请您按照以下步骤操作</p>
			<div class="mb-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">1</div>
				<p class="m-0 ms-3">打开QQ，进入自助机器人聊天窗口</p>
			</div>
			<div class="my-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">2</div>
				<p class="m-0 ms-3">发送"设备验证"至聊天窗口</p>
			</div>
			<div class="my-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">3</div>
				<p class="m-0 ms-3">根据机器人后续发送的指引操作</p>
			</div>
			<div class="alert alert-primary p-2">该功能需账号已经绑定了QQ机器人方可使用</div>
			<button class="col-12 mt-4 btn btn-outline-primary rounded-pill">返回</button>
		</div>

		<div class="p-4" id="qrcode_page" style="display: none;">
		    <h3 class="mt-4"><b>设备扫码验证</b></h3>
			<p style="font-size: .8rem;">请您按照以下步骤操作</p>
			<div class="text-center">
				<img style="width: 220px;height: 220px;" id="qrcode_img" src="data:image;base64,R0lGODlhBAAEAIAAAMzMzAAAACH5BAAAAAAALAAAAAAEAAQAAAIEhI8JBQA7" />
			</div>
			<div class="my-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">1</div>
				<p class="m-0 ms-3">使用旧设备打开软件</p>
			</div>
			<div class="my-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">2</div>
				<p class="m-0 ms-3">点击首页右上角的"扫码"按钮</p>
			</div>
			<div class="my-4 d-flex align-items-center">
				<div class="btn d-block btn-outline-primary rounded-circle px-3 py-2">3</div>
				<p class="m-0 ms-3">扫描上方的二维码完成验证</p>
			</div>
			<button class="col-12 mt-4 btn btn-outline-primary rounded-pill">返回</button>
		</div>

        <div class="p-4" id="finish" style="display: none;">
            <div class="text-center" style="margin-top:20vh">
                <h2><b>验证成功</b></h2>
		        <p class="text-secondary">您已通过设备验证，现在请退出本页面继续完成登录</p>
            </div>
		</div>

	    <script type="text/javascript" src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script>
	    <script src="https://cdn.bootcdn.net/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
	    <script>
			document.onreadystatechange = function(){
				if(document.readyState == 'complete'){
					document.getElementById("preloader").style.display="none";
				}
			}
			$('#getcode').click(_=>{
				let user=getvalue('user');
			    let mobile=$('#mobile_input').val();
				if(mobile.length!==11){
					$.alert({title:'错误',type:'red',content:'手机号格式有误'}); 
					return;
				}
			    let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>操作正在处理</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
				$.ajax({
					type:"POST",
					timeout:10000,
					url:"https://sf-api.suxber.live/Account/AuthVerify",
					data:JSON.stringify({"data":{"type":'sendcode',"user":user,"mobile":mobile}}),
					contentType:"application/json;charset=UTF-8",
					success:function (data) {
					    if(data.code==200){
							$.alert({content:'验证码已发送'}); 
						}else if(data.code==300){
							window.location.href=data.data;
						}else{
							$.alert({title:'错误',type:'red',content:data.msg}); 
						}
						loading.close();
					},
					error:function (msg) {
					    loading.close();
						$.alert({title:'错误',type:'red',content:'网络异常，请稍后再试'}); 
					}
				});
			});
			$('#mobile_page .btn-primary').click(_=>{
				let user=getvalue('user');
			    let mobile=$('#mobile_input').val();
				let code=$('#code').val();
				if(user.length<1){
					$.alert({title:'错误',type:'red',content:'账号或手机号不能留空'}); 
					return;
				}
				if(mobile.length!==11){
					$.alert({title:'错误',type:'red',content:'手机号格式有误'}); 
					return;
				}
				if(code.length<1){
					$.alert({title:'错误',type:'red',content:'验证码不能留空'}); 
					return;
				}
				let env=decodeURIComponent(getvalue('env'))
			    let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>操作正在处理</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
				$.ajax({
					type:"POST",
					timeout:10000,
					url:"https://sf-api.suxber.live/Account/AuthVerify",
					data:JSON.stringify({"data":{"type":'usecode',"user":user,"mobile":mobile,"code":code,"env":env}}),
					contentType:"application/json;charset=UTF-8",
					success:function (data) {
					    if(data.code==200){
							$('#mobile_page').hide();
							$('#finish').show();
						}else if(data.code==300){
							window.location.href=data.data;
						}else{
							$.alert({title:'错误',type:'red',content:data.msg}); 
						}
						loading.close();
					},
					error:function (msg) {
					    loading.close();
						$.alert({title:'错误',type:'red',content:'网络异常，请稍后再试'}); 
					}
				});
			});
			$('#mobile_page .btn-outline-primary').click(_=>{
			    $('#mobile_page').hide();
			    $('#step1').show();
			});
			$('#mobile').click(_=>{
			    $('#step1').hide();
			    $('#mobile_page').show();
			});
			$('#qq_page .btn-outline-primary').click(_=>{
			    $('#qq_page').hide();
			    $('#step1').show();
			});
			$('#qq').click(_=>{
			    $('#step1').hide();
			    $('#qq_page').show();
			});
			$('#qrcode_page .btn-outline-primary').click(_=>{
			    $('#qrcode_page').hide();
			    $('#step1').show();
			});
			$('#qrcode').click(_=>{
			    let user=getvalue('user');
			    let loading=$.alert({title:'',content:'<div class="p-2 d-flex align-items-center justify-content-between"> <strong>操作正在处理</strong> <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div></div>',buttons:[],closeIcon:false});
			    $.ajax({
			    	type:"POST",
			    	timeout:10000,
			    	url:"https://sf-api.suxber.live/Account/AuthVerify",
			    	data:JSON.stringify({"data":{"type":'qrcode',"user":user}}),
			    	contentType:"application/json;charset=UTF-8",
			    	success:function (data) {
			    	    if(data.code==200){
			    			$('#qrcode_img').attr('src','https://api.pwmqr.com/qrcode/create/?url='+data.data)
							$('#step1').hide();
							$('#qrcode_page').show();
						}else if(data.code==300){
			    			window.location.href=data.data;
			    		}else{
			    			$.alert({title:'错误',type:'red',content:data.msg}); 
			    		}
			    		loading.close();
			    	},
			    	error:function (msg) {
			    	    loading.close();
			    		$.alert({title:'错误',type:'red',content:'网络异常，请稍后再试'}); 
			    	}
			    });
			});
			function getvalue(variable) {
				var query = window.location.search.substring(1);
				var vars = query.split("&");
			    for (var i = 0; i < vars.length; i++) {
			        var pair = vars[i].split("=");
			        if (pair[0] == variable) {
			            return pair[1]
			        }
			    }
			    return (false)
			}
	    </script>
	</body>
</html>
